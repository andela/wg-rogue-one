{% extends "base_wide.html" %}
{% load i18n staticfiles cache wger_extras %}

<!--
        Title
-->
{% block title %}{% trans "Muscle overview" %}{% endblock %}


{% block header %}
<script src="{% static 'js/exercises.js' %}"></script>
<script src="{% static 'js/muscles.js' %}"></script>

<script>
$(document).ready(function() {
    //Prefetch the background images
    {% for muscle in muscle_list|first %}
        wgerPrefetchImages(['/static/images/muscles/main/muscle-' + {{muscle.id}} + '.svg']);
    {% endfor %}
    wgerPrefetchImages(['/static/images/muscles/muscular_system_back.svg']);


    // Hightlight the first element
    wgerHighlightMuscle($('.muscle').first());

    // Highlight on hover
    $('.muscle').hover(function(e) {
        e.preventDefault();
        wgerHighlightMuscle(this);
    });

    var muscleSystem = $('#muscle-system');
    // Add front muscles by default
    muscleSystem.append( musclesFront );
    $('#svg2').css({'transform':'translate(-23px, -36px) scale(0.75)', 'opacity':0});

    // flip image to view front side
    $('#flip-front').on('click', ()=>{
        $('.muscles-back').remove();
        $('.muscles-front').remove();
        muscleSystem.css('background-image',
            'url(/static/images/muscles/main/muscle-2.svg),' +
            'url(/static/images/muscles/muscular_system_front.svg)');
        muscleSystem.append( musclesFront );
        $('#svg2').css({'transform':'translate(-23px, -36px) scale(0.75)', 'opacity':0});
    });
    // flip image to view back side
    $('#flip-back').on('click', ()=>{
        $('.muscles-front').remove();
        muscleSystem.css('background-image',
            'url(/static/images/muscles/main/muscle-11.svg),' +
            'url(/static/images/muscles/muscular_system_back.svg)');
        muscleSystem.append( musclesBack );
        $('#svg2').css({'transform':'translate(-26px, -48px) scale(0.75)', 'opacity':0});
    });

    document.onmousemove = function(e){
    if ($(e.target).is('path')){
        var divid = event.target.getAttribute('myid');
        var isFront = (event.target.getAttribute('is-front') === 'true') ? 'front' : 'back';
        //Reset all other highlighted muscles
        $muscle = $('.muscle');
        $muscle.removeClass('muscle-active');
        $muscle.addClass('muscle-inactive');

        // highlight image muscle
        $('#muscle-system').css('background-image',
            'url(/static/images/muscles/main/muscle-'+ divid +'.svg),' +
            'url(/static/images/muscles/muscular_system_' + isFront +'.svg)');

        // Highlight the current one
        $('li[data-target=muscle-' + divid +']').removeClass('muscle-inactive');
        $('li[data-target=muscle-' + divid +']').addClass('muscle-active');
        $('.exercise-list').hide();
        $('#muscle-' + divid).show();
    }
}
});

</script>
{% endblock %}


<!--
        Main Content
-->
{% block content %}
{% cache cache_timeout muscle-overview language.id %}
{% trans "Hover with the mouse over the muscles to show corresponding exercises." %}

<div class="row">
    <div class="col-sm-4 col-xs-6">
        <h4 style="padding-bottom:0.5em;">{% trans "Muscles" %}</h4>
        <div id="muscle-system"
             class="muscle-background"
             style="background-image: url('/static/images/muscles/muscular_system_front.svg');">
        </div>
    </div>
    <div class="col-sm-4 col-xs-6">
        {# Why do we need to use |first? #}
        {% regroup muscle_list|first by is_front as muscle_group %}
        {% for group in muscle_group %}
            {% if group.grouper %}
                <h4><button class="btn btn-default btn-sm" id="flip-front">{% trans "Front side" %}</button></h4>
            {% else %}
                <h4><button class="btn btn-default btn-sm flip-img" id="flip-back">{% trans "Back side" %}</button></h4>
            {% endif %}

            <ul class="muscle-list">
            {% for muscle in group.list %}
            <li class="muscle"
                data-target="muscle-{{muscle.id}}"
                data-is-front="{{muscle.is_front}}"
                data-name="{{muscle.name}}"
                itemscope itemtype="http://schema.org/Muscle">
                <span itemprop="name">{{muscle.name}}</span>
            </li>
            {% endfor %}
            </ul>
        {% endfor %}
    </div>
    <div class="col-sm-4 col-xs-12">
        {% for muscle in muscle_list|first %}
            <div id="muscle-{{muscle.id}}" style="display:none;" class="exercise-list">
                <h4>{% trans "Exercises" %}</h4>
                <ul class="exercise-overview">
                    {% for exercise in muscle.exercise_set.select_related %}
                    {% if exercise.language in active_languages %}
                    <li class="exercise">
                        <a href="{{exercise.get_absolute_url}}">{{exercise}}</a>
                    </li>
                    {% endif %}
                    {% empty %}
                    <li>
                        <em>{% trans "No exercises that mainly train this muscle" %}</em>
                    </li>
                    {% endfor %}
                </ul>
            </div>
        {% endfor %}
    </div>
</div>
{% endcache %}
{% endblock %}


<!--
        Side bar
-->
{% block sidebar %}
{% endblock %}
